<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>jEvent - Шаблон страницы</title>

    <!-- CSS -->
    <link href="../css/normalize.css" rel="stylesheet">
    <link href="../css/bootstrap.css" rel="stylesheet">
    <link href="../css/font-awesome.css" rel="stylesheet">
    <link href="../css/custom.css" rel="stylesheet">

</head>
<body>
<div class="container-fluid">
    <section class="row" id="navigation">
        <!--top menu here -->
        <!--from __data-source.html-->
    </section>

    <section class="row" id="main-content">

        <div id="left-menu" class="col-sm-3 col-md-3 col-lg-2 hidden-xs sidebar">
            <!--Left content menu here-->
            <div id="left-event-view-menu">
                <ul class="nav nav-pills nav-stacked">
                    <li class="subheader">Действия</li>
                    <li role="separator" class="divider"></li>
                    <li id="create-new" class="create-new"><a class="" href="#"><i
                            class="fa fa-plus"
                            aria-hidden="true"></i>Добавить спикера</a>
                    </li>
                    <li id="add-from-jira" class=""><a class="" href="#"><i
                            class="fa fa-cloud-download"
                            aria-hidden="true"></i>Обновить из jira</a>
                    </li>
                    <li id="update" class=""><a class="" href="#"><i
                            class="fa fa-refresh"
                            aria-hidden="true"></i>Обновить</a>
                    </li>
                    <li id="edit" class=""><a class="" href="#"><i
                            class="fa fa-pencil"
                            aria-hidden="true"></i>Редактировать</a>
                    </li>
                    <li id="delete" class=""><a class="" href="#"><i
                            class="fa fa-trash"
                            aria-hidden="true"></i>Удалить</a>
                    </li>


                </ul>
                <form id="control-panel" class="menu-control-panel">
                    <ul class="nav nav-pills nav-stacked">
                        <li class="subheader">Фильтрация</li>
                        <li role="separator" class="divider"></li>

                        <li class="">

                        </li>

                        <li id="statuses" class="">
                            <!--versions from json-->
                        </li>

                        <li class="">
                            <button type="button" class="btn btn-info" data-toggle="button" aria-pressed="false"
                                    autocomplete="off">
                                Применить
                            </button>
                        </li>
                    </ul>
                </form>


            </div>
        </div>

        <div class="col-sm-9  col-md-9 col-lg-10 main">

            <!-- Content here -->

            <div class="header-row">
                <h2 id="conf-name"></h2>
            </div>

            <div id="search-panel">
                <div id="event-view-search">
                    <div class="row control-panel-row">
                        <div class="content-header col-lg-8">
                            <div class="form-group">
                                <label class="col-sm-2 control-label control-panel-label"
                                       for="sort-by">Сортировка</label>
                                <div class="col-sm-3">
                                    <select id="sort-by" class="col-sm-3 form-control">
                                        <option>По алфавиту</option>
                                        <option>По статусу</option>
                                        <option>По статусу (возрастание)</option>
                                    </select>
                                </div>
                            </div>
                        </div>


                        <div class="content-search col-lg-4">

                            <form class="input-group">
                                <input type="text" class="form-control" placeholder="Поиск спикера">
                          <span class="input-group-btn">
                            <button class="btn btn-default" type="button">Найти</button>
                          </span>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a id="tab-speakers" href="#speakers"
                                                              aria-controls="speakers" role="tab"
                                                              data-toggle="tab">Спикеры</a></li>
                    <li role="presentation"><a id="tab-partners" href="#partners" aria-controls="partners" role="tab"
                                               data-toggle="tab">Партнеры </a></li>
                    <li role="presentation"><a id="tab-conference" href="#conference" aria-controls="conference"
                                               role="tab"
                                               data-toggle="tab">Конференция</a></li>

                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="speakers">
                        <table id="speaker-table" class="table table-hover avatar-table">
                            <thead>
                            <tr>
                                <th class="avatar"></th>
                                <th>Имя и Компания</th>
                                <th>Тема</th>
                                <th>Тэги</th>
                                <th>Статус в jira</th>
                                <th>Источник</th>
                                <th>Рейтинги</th>
                            </tr>
                            </thead>
                            <tbody>


                            </tbody>
                        </table>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="partners">
                        <table id="partner-table" class="table table-hover avatar-table">
                            <thead>
                            <tr>
                                <th class="avatar"></th>
                                <th>Партнер</th>
                                <th>Статус</th>
                                <th>Спонсируют</th>
                                <th>Представитель</th>
                                <th>Телефон</th>
                                <th>Email</th>
                            </tr>
                            </thead>
                            <tbody>


                            </tbody>
                        </table>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="conference">
                        <div class="row">
                            <div class="col-sm-6">
                                <table id="event-table" class="table table-hover avatar-table">
                                    <thead>
                                    <tr>
                                        <th>Поле</th>
                                        <th>Значение</th>
                                    </tr>
                                    </thead>
                                    <tbody>


                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div>


        </div>

    </section>
    <!--footer here -->
    <!--from __data-source.html-->
    <section id="footer" class="row footer">

    </section>
</div>


<!-- javascript -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/tether/1.3.1/js/tether.min.js"></script>

<!--<script src="../js/bootstrap.js"></script>-->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
<script>
    //    add header navigation
    $("#navigation").load("../je_templates/__data-source.html #navigation nav");
    //    add footer
    $("#footer").load("../je_templates/__data-source.html #footer .container");

</script>

<script src="../js/parser.js" type="text/javascript"></script>

<script type="text/javascript">
    var map;
    var actualSpeechStatuses = new Set();

    /* Enums in maps*/
    var speechStatusMap = new Map();
    var partnerStatusMap = new Map();

    var eventId = null;



    function displayPage() {
        var elTableSpeaker = $("#speaker-table").find("tbody");
        var elTablePartner = $("#partner-table").find("tbody");
        var elTableEvent = $("#conference").find("tbody");
        var speechCount = 0;
        var partnerCount = 0;

        elTableSpeaker.empty();
        elTablePartner.empty();

        var event = map.get(eventId);
//            add conf name
        $("#conf-name").append('Конференция: ' + event.name + ' ' + event.version);

        event.speechArr.forEach(function (speech) {
            displaySpeeches(elTableSpeaker, speech, speech.speaker, speech.event);
            actualSpeechStatuses.add(speechStatusMap.get(speech.status));
            speechCount++;
        });

        event.partnerArr.forEach(function (partner) {
            displayPartner(elTablePartner, partner, event);
            partnerCount++;
        });
        displayActualSpeechesStatuses(actualSpeechStatuses);
        displayEventContent(elTableEvent, event);
        addTabLabels(speechCount, partnerCount);

    }

    function initEnums() {
        speechStatusMap.set(1, "Новый");
        speechStatusMap.set(2, "Рассмотрение заявки");
        speechStatusMap.set(3, "Описание доклада");
        speechStatusMap.set(4, "Тестирование, тренинги");
        speechStatusMap.set(5, "Требует уточнения");
        speechStatusMap.set(6, "Фидбек спикера");
        speechStatusMap.set(7, "Фидбек участников");
        speechStatusMap.set(8, "Анализ");
        speechStatusMap.set(9, "Закрыта");

        partnerStatusMap.set(1, '<button type="button" class="btn btn-xs color-gold" disabled="disabled">Gold</button>');
        partnerStatusMap.set(2, '<button type="button" class="btn btn-xs color-silver" disabled="disabled">Silver</button>');
        partnerStatusMap.set(3, '<button type="button" class="btn btn-xs color-bronze" disabled="disabled">Bronze</button>');
        partnerStatusMap.set(4, '<button type="button" class="btn btn-xs color-info" disabled="disabled">Info</button>');
    }

    function init() {
        eventId = parseInt(getUrlParameter('id'));
        initEnums();
        map = getData();
        displayPage();
    }


    function displaySpeeches(el, speech, speaker, event) {
        var strName = '<div class="two-rows"><a href="' + '../speaker/view.html?id=' + speaker.id + '">' + speaker.name + '</a></div>';
        var strSource = '';
        var strRating = '';
        var strTags = '';

        if (speech.partner == null) {
            strName += '<div>' + speaker.employer + '</div>';
        } else {
            strName += '<div> <a href="' + '../partner/view.html?id=' + speech.partner.id + '">' + speech.partner.name + '</a></div>';
        }

        if (speech.source == 'jira') {
            strSource = '<button type="button" class="btn btn-xs btn-primary" disabled="disabled">jira</button>';
        } else {
            strSource = '<button type="button" class="btn btn-xs btn-warning" disabled="disabled">Вручную</button>';
        }
        speaker.speechArr.forEach(function (speech) {
            if (speech.rating != null) {
                strRating = strRating + '<div class=""> <a href="' + '../event/view.html?id=' + event.id + '">' + event.name + '</a>' + ' : ' + speech.rating + '%</div>';
            }
        });
        speech.tags.forEach(function (tag) {
            strTags = strTags + '<div class="speech-tag">' + tag + '</div>';
        });

        $(el).append('<tr>' +
                '<th class="avatar" scope="row"><img class="media-object img-circle img-responsive" src="' + speaker.photo + '"></th>' +
                '<td>' + strName + '</td>' +
                '<td><a href="' + '../speech/view.html?id=' + speech.id + '">' + speech.name + '</a></td>' +
                '<td>' + strTags + '</td>' +
                '<td><button type="button" class="btn btn-xs btn-primary" disabled="disabled">' + speechStatusMap.get(parseInt(speech.status)) + '</button></td>' +
                '<td>' + strSource + '</td>' +
                '<td>' + strRating + '</td>' +
                '</tr>' +
                '<tr>');
    }

    function displayPartner(el, partner, event) {
        var strSpeakers = '';
        partner.speechArr.forEach(function (speech) {
            if (speech.event.id == event.id) {
                strSpeakers += '<div class=""><a href="' + '../speaker/view.html?id=' + speech.speaker.id + '">' + speech.speaker.name + '</a></div>'
            }
        });

        $(el).append('<tr>' +
                '<th class="avatar" scope="row"><img class="media-object img-circle img-responsive" src="' + partner.logo + '"></th>' +
                '<td>' + partner.name + '</td>' +
                '<td>' + partnerStatusMap.get(parseInt(partner.status)) + '</td>' +
                '<td>' + strSpeakers + '</td>' +
                '<td>' + partner.contactName + '</td>' +
                '<td>' + partner.contactPhone + '</td>' +
                '<td>' + partner.contactEmail + '</td>' +
                '</tr>' +
                '<tr>');
    }

    function displayEventContent(el, event) {
        el.empty();
        el.append('<tr>' +
                '<th scope="row">Название проекта в jira</th>' +
                '<td>' + event.jiraName + '</td>' +
                '</tr>' +
                '<th scope="row">Версия</th>' +
                '<td>' + event.version + '</td>' +
                '</tr>' +
                '<th scope="row">Дата проведения</th>' +
                '<td>' + event.date + '</td>' +
                '</tr>'
        );
    }


    function displayActualSpeechesStatuses(v) {
        var el = $('#statuses');
        var str = '<p>Показать статусы:</p>';
        el.empty();
        v.forEach(function (entry) {
            str = str + '<div class="checkbox">' +
                    '<label>' +
                    '<input type="checkbox" value="' + entry + '" checked> ' + entry +
                    '</label>' +
                    '</div>';
        });
        el.append(str);
    }

    function addTabLabels(speakerCount, partnerCount) {
        if (speakerCount != null) {
            $("#tab-speakers").append(' <span class="label label-success">' + speakerCount + '</span>');
        }
        if (partnerCount != null) {
            $("#tab-partners").append(' <span class="label label-warning">' + partnerCount + '</span>');
        }
    }


    init();


</script>
</body>

</html>